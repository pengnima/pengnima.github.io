(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c46c9da"],{2590:function(e,t,r){"use strict";var n=r("dece"),o=r.n(n);o.a},"32bb":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"role"},[r("breadcrumb",{attrs:{routeMeta:e.$route.meta}}),r("el-card",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-input",{attrs:{placeholder:"请输入需要查找的用户名",clearable:""},on:{clear:function(t){return e.getRoleList()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:e.queryInfo.status,callback:function(t){e.$set(e.queryInfo,"status",t)},expression:"queryInfo.status"}},[r("el-option",{attrs:{label:"全部",value:null}}),r("el-option",{attrs:{label:"有效",value:1}}),r("el-option",{attrs:{label:"无效",value:0}})],1)]},proxy:!0},{key:"append",fn:function(){return[r("el-button",{attrs:{icon:"el-icon-search"},on:{click:function(t){return e.getRoleList()}}})]},proxy:!0}]),model:{value:e.queryInfo.name,callback:function(t){e.$set(e.queryInfo,"name",t)},expression:"queryInfo.name"}})],1),r("el-col",{attrs:{span:4}},[e.$PowerKey(e.powerKey.RolePowerKey.RoleAdd)?r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.RoleDiaLog.roleInfo=!0,e.postNum=1}}},[e._v("添加角色")]):e._e()],1)],1),r("el-divider"),r("el-table",{attrs:{data:e.roleList,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"index",label:"#"}}),r("el-table-column",{attrs:{prop:"name",label:"角色"}}),r("el-table-column",{attrs:{prop:"subsystem_name",label:"所属子系统"}}),r("el-table-column",{attrs:{prop:"memo",label:"描述"}}),r("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),r("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{disabled:!e.$PowerKey(e.powerKey.RolePowerKey.RoleUpdateStatus),value:1==t.row.status},on:{change:function(r){return e.handleSwitchChange(t.row)}}})]}}])}),r("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$PowerKey(e.powerKey.RolePowerKey.RoleUpdate)?r("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(r){return e.handleEditRole(t.row.id)}}},[e._v("编辑")]):e._e(),e.$PowerKey(e.powerKey.RolePowerKey.RoleInfo)?r("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-refresh"},on:{click:function(r){return e.handleLoadRole(t.row)}}},[e._v("重载")]):e._e(),e.$PowerKey(e.powerKey.RolePowerKey.RolePriv)?r("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-s-tools"},on:{click:function(r){return e.handleRightChange(t.row)}}},[e._v("分配权限")]):e._e()]}}])})],1),r("pagination",{attrs:{total:e.listTotal,pageSizes:[5,10,20],queryInfo:e.queryInfo,queryFunc:e.getRoleList}})],1),r("el-dialog",{attrs:{title:1==e.postNum?"添加角色":"修改角色",visible:e.RoleDiaLog.roleInfo,width:"40%"},on:{"update:visible":function(t){return e.$set(e.RoleDiaLog,"roleInfo",t)},close:function(t){return e.handleCloseDialog(e.$refs.RoleRef)}},scopedSlots:e._u([{key:"footer",fn:function(){return[r("span",{staticClass:"dialog-footer"},[r("el-button",{on:{click:function(t){e.RoleDiaLog.roleInfo=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSureRole(e.postNum)}}},[e._v("确 定")])],1)]},proxy:!0}])},[r("el-form",{ref:"RoleRef",attrs:{model:e.roleForm,"status-icon":"",rules:e.formRules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"角色名",prop:"name"}},[r("el-input",{model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1),r("el-form-item",{attrs:{label:"描述",prop:"memo"}},[r("el-input",{attrs:{type:"text"},model:{value:e.roleForm.memo,callback:function(t){e.$set(e.roleForm,"memo",t)},expression:"roleForm.memo"}})],1)],1)],1),r("el-dialog",{attrs:{title:"分配角色权限",visible:e.RoleDiaLog.editRight,width:"30%"},on:{"update:visible":function(t){return e.$set(e.RoleDiaLog,"editRight",t)},close:e.handleCloseEditRight},scopedSlots:e._u([{key:"footer",fn:function(){return[r("el-button",{on:{click:function(t){e.RoleDiaLog.editRight=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSureRightChange}},[e._v("确 定")])]},proxy:!0}])},[r("div",{staticClass:"dia_body"},[r("el-tree",{ref:"treeRef",attrs:{data:e.rightList,"show-checkbox":"","default-expand-all":"","default-checked-keys":e.checkedKeys,"node-key":"id","highlight-current":"",props:e.defaultProps,"expand-on-click-node":!1,"check-on-click-node":""}})],1)])],1)},o=[],a=(r("99af"),r("4160"),r("45fc"),r("b0c0"),r("159b"),r("2909")),s=(r("96cf"),r("1da1")),i=r("5530"),l=r("4ec3"),c=(r("eeb9"),r("2fbc")),u=r("1799"),m=r("2f62"),d={name:"roles",created:function(){this.roleBtnList=this.powerList[this.$route.path]},mounted:function(){this.getRoleList()},computed:Object(i["a"])({},Object(m["c"])("menu",["powerList"])),data:function(){return{postNum:null,roleBtnList:[],listTotal:null,queryInfo:{name:"",status:null,pageParam:{page:1,pageSize:5}},RoleDiaLog:{roleInfo:!1,editRight:!1},roleForm:{name:"",memo:""},formRules:{name:[{required:!0,message:"请输入角色名",trigger:"blur"},{min:3,max:9,message:"长度在 3 到 9 个字符",trigger:"blur"}],memo:[{required:!0,message:"请输入描述信息",trigger:"blur"},{min:4,max:50,message:"长度在 4 到 50 个字符",trigger:"blur"}]},roleList:[],roleId:null,rightList:[],checkedKeys:[],defaultProps:{children:"List",label:"name"}}},methods:{$PowerKey:function(e){return this.roleBtnList&&this.roleBtnList.some((function(t){return t.name_en==e}))},getRoleList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["l"])(e.queryInfo);case 2:r=t.sent,e.roleList=r.value,(!e.listTotal||e.listTotal!=r.num)&&(e.listTotal=r.num);case 5:case"end":return t.stop()}}),t)})))()},handleSwitchChange:function(e){var t=this;this.$confirm("确定要修改该用户的状态?","提示",{type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.status=1===e.status?0:1,n={id:e.id,status:e.status},r.next=4,Object(l["v"])(n);case 4:o=r.sent,1e4==o.code&&(t.getRoleList(),t.$message.success(o.message));case 6:case"end":return r.stop()}}),r)}))),(function(){console.log("点击了取消")}))},handleCloseDialog:function(e){this.roleForm={name:"",memo:""},this.postNum=null,e&&e.resetFields()},handleSureRole:function(e){var t=this;this.$refs.RoleRef.validate((function(r){r&&(1==e?t.SureAddRole():2==e&&t.SureEditRole())}))},handleEditRole:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.roleId=e,t.RoleDiaLog.roleInfo=!0,t.postNum=2,n={id:e},r.next=6,Object(l["t"])(n);case 6:o=r.sent,t.roleForm.name=o.value.name,t.roleForm.memo=o.value.memo;case 9:case"end":return r.stop()}}),r)})))()},SureAddRole:function(){var e=this;this.$confirm("确定要添加该角色?","提示",{type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["s"])(e.roleForm);case 2:if(r=t.sent,1e4==r.code){t.next=6;break}return e.$message.error(r.message),t.abrupt("return",e.RoleDiaLog.roleInfo=!1);case 6:e.getRoleList(),e.$message.success(r.message),e.RoleDiaLog.roleInfo=!1;case 9:case"end":return t.stop()}}),t)}))),(function(){console.log("点击了取消")}))},SureEditRole:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={id:e.roleId,memo:e.roleForm.memo,name:e.roleForm.name},t.next=3,Object(l["u"])(r);case 3:if(n=t.sent,1e4==n.code){t.next=7;break}return e.$message.error(n.message),t.abrupt("return",e.RoleDiaLog.roleInfo=!1);case 7:e.getRoleList(),e.$message.success(n.message),e.RoleDiaLog.roleInfo=!1;case 10:case"end":return t.stop()}}),t)})))()},handleLoadRole:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(e),r.next=3,Object(l["t"])({id:e.id});case 3:if(n=r.sent,1e4==n.code){r.next=6;break}return r.abrupt("return",t.$message.error(n.message));case 6:o=n.value,e=Object(i["a"])({},o),t.$message.success(n.message);case 9:case"end":return r.stop()}}),r)})))()},handleRightChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.roleId=e.id,t.RoleDiaLog.editRight=!0,r.next=4,Object(l["F"])({id:e.id});case 4:if(n=r.sent,1e4==n.code){r.next=7;break}return r.abrupt("return",t.$message.error(n.message));case 7:t.rightList=n.value.oneMenuList,console.log(t.rightList),t.amendData(t.rightList);case 10:case"end":return r.stop()}}),r)})))()},handleSureRightChange:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$refs.treeRef.getCheckedKeys(),n=e.$refs.treeRef.getHalfCheckedKeys(),console.log(n,r),t.next=5,Object(l["G"])({priv_id:[].concat(Object(a["a"])(n),Object(a["a"])(r)),role_id:e.roleId});case 5:if(o=t.sent,console.log(o),1e4==o.code){t.next=9;break}return t.abrupt("return",e.$message.error(o.message));case 9:e.$message.success(o.message),e.RoleDiaLog.editRight=!1,console.log("修改权限");case 12:case"end":return t.stop()}}),t)})))()},handleCloseEditRight:function(){this.rightList=[],this.checkedKeys=[],this.roleId=null,console.log("关闭权限")},amendData:function(e){var t=this;if(e){var r=/.+List/;e.forEach((function(e){for(var n in e)r.test(n)&&(e["List"]=e[n],delete e[n],t.amendData(e["List"]))})),this.processData(e)}},processData:function(e){var t=this;e.forEach((function(e){e.hasOwnProperty("List")&&0!=e["List"].length?t.processData(e["List"]):1==e["checked"]&&t.checkedKeys.push(e["id"])}))}},components:{Breadcrumb:c["a"],Pagination:u["a"]}},f=d,p=(r("2590"),r("2877")),g=Object(p["a"])(f,n,o,!1,null,"c31cfcdc",null);t["default"]=g.exports},dece:function(e,t,r){}}]);
//# sourceMappingURL=chunk-4c46c9da.65d769ae.js.map