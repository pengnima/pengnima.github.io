(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29459e7f"],{9419:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user"},[r("breadcrumb",{attrs:{routeMeta:e.$route.meta}}),r("el-card",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-input",{attrs:{placeholder:"请输入需要查找的用户名",clearable:""},on:{clear:function(t){return e.getUserList()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:e.queryInfo.status,callback:function(t){e.$set(e.queryInfo,"status",t)},expression:"queryInfo.status"}},[r("el-option",{attrs:{label:"全部",value:null}}),r("el-option",{attrs:{label:"有效",value:1}}),r("el-option",{attrs:{label:"无效",value:0}})],1)]},proxy:!0},{key:"append",fn:function(){return[r("el-button",{attrs:{icon:"el-icon-search"},on:{click:function(t){return e.getUserList()}}})]},proxy:!0}]),model:{value:e.queryInfo.name,callback:function(t){e.$set(e.queryInfo,"name",t)},expression:"queryInfo.name"}})],1),r("el-col",{attrs:{span:4}},[e.$PowerKey(e.powerKey.UserPowerKey.UserAdd)?r("el-button",{attrs:{type:"primary"},on:{click:e.handleAddUserClick}},[e._v("添加用户")]):e._e()],1)],1),r("el-divider"),r("el-table",{attrs:{data:e.userList,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"index",label:"#"}}),r("el-table-column",{attrs:{prop:"name",label:"用户名"}}),r("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),r("el-table-column",{attrs:{prop:"mobile_phone",label:"手机号"}}),r("el-table-column",{attrs:{label:"用户类型","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tooltip",{attrs:{disabled:1!=t.row.member,effect:"dark",content:"点击升级成代理",placement:"left",enterable:!1}},[r("el-tag",{style:{cursor:1==t.row.member?"pointer":"auto"},attrs:{type:e.commonFn.UserType(t.row.member).color},on:{click:function(r){return e.handleUpAgency(t.row)}}},[e._v(e._s(e.commonFn.UserType(t.row.member).name))])],1)]}}])}),r("el-table-column",{attrs:{prop:"login_account",label:"登陆账号"}}),r("el-table-column",{attrs:{prop:"last_login_time",label:"登陆时间"}}),r("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{disabled:!e.$PowerKey(e.powerKey.UserPowerKey.UserUpdateStatus),value:1==t.row.status},on:{change:function(r){return e.handleSwitchChange(t.row)}}})]}}])}),r("el-table-column",{attrs:{label:"操作",width:"400",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$PowerKey(e.powerKey.UserPowerKey.UserUpdate)?r("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(r){return e.handleEditUserClick(t.row.id)}}},[e._v("编辑")]):e._e(),e.$PowerKey(e.powerKey.UserPowerKey.UserInfo)?r("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-refresh"},on:{click:function(r){return e.handleLoadUser(t.row)}}},[e._v("重载")]):e._e(),e.$PowerKey(e.powerKey.UserPowerKey.UserDeployRole)?r("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-s-tools"},on:{click:function(r){return e.handleRoleChange(t.row)}}},[e._v("分配角色")]):e._e(),e.$PowerKey(e.powerKey.UserPowerKey.UserDeployRole)?r("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-s-tools"},on:{click:function(r){return e.handleAgencyChange(t.row)}}},[e._v("分配代理")]):e._e()]}}])})],1),r("pagination",{attrs:{total:e.listTotal,pageSizes:[5,10,20],queryInfo:e.queryInfo,queryFunc:e.getUserList}})],1),r("el-dialog",{attrs:{title:1==e.postNum?"添加用户":"修改用户",visible:e.userDiaLog.userInfo,width:"40%"},on:{"update:visible":function(t){return e.$set(e.userDiaLog,"userInfo",t)},close:function(t){return e.handleCloseDialog(e.$refs.UserFormRef)}},scopedSlots:e._u([{key:"footer",fn:function(){return[r("span",{staticClass:"dialog-footer"},[r("el-button",{on:{click:function(t){e.userDiaLog.userInfo=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSureUser(e.postNum)}}},[e._v("确 定")])],1)]},proxy:!0}])},[r("el-form",{ref:"UserFormRef",attrs:{model:e.userForm,"status-icon":"",rules:e.formRules,"label-width":"80px"}},[2!=e.postNum?r("el-form-item",{attrs:{label:"账户名",prop:"login_account"}},[r("el-input",{model:{value:e.userForm.login_account,callback:function(t){e.$set(e.userForm,"login_account",t)},expression:"userForm.login_account"}})],1):e._e(),r("el-form-item",{attrs:{label:"姓名",prop:"name"}},[r("el-input",{model:{value:e.userForm.name,callback:function(t){e.$set(e.userForm,"name",t)},expression:"userForm.name"}})],1),2!=e.postNum?r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1):e._e(),r("el-form-item",{attrs:{label:"手机号",prop:"mobile_phone"}},[r("el-input",{attrs:{type:"text"},model:{value:e.userForm.mobile_phone,callback:function(t){e.$set(e.userForm,"mobile_phone",t)},expression:"userForm.mobile_phone"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{type:"text"},model:{value:e.userForm.email,callback:function(t){e.$set(e.userForm,"email",t)},expression:"userForm.email"}})],1),r("el-form-item",{attrs:{label:"性别"}},[r("el-select",{model:{value:e.userForm.sex,callback:function(t){e.$set(e.userForm,"sex",t)},expression:"userForm.sex"}},[r("el-option",{attrs:{label:"男",value:1}}),r("el-option",{attrs:{label:"女",value:0}}),r("el-option",{attrs:{label:"未知",value:2}})],1)],1)],1)],1),r("el-dialog",{attrs:{title:"分配用户角色",visible:e.userDiaLog.editRole,width:"30%"},on:{"update:visible":function(t){return e.$set(e.userDiaLog,"editRole",t)},close:e.handleCloseEditRole},scopedSlots:e._u([{key:"footer",fn:function(){return[r("el-button",{on:{click:function(t){e.userDiaLog.editRole=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSureRoleChange}},[e._v("确 定")])]},proxy:!0}])},[r("div",{staticClass:"dia_body"},[r("p",[e._v("当前用户："+e._s(e.userForm.name))]),r("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),r("div",{staticStyle:{margin:"15px 0"}}),e._l(e.roleList,(function(t){return r("el-row",{key:t.subsystem_id},[r("label",{staticStyle:{color:"#f55"}},[e._v(e._s(t.subsystem_name))]),e.groupObj[t.subsystem_id+""]?r("el-checkbox-group",{model:{value:e.groupObj[t.subsystem_id+""],callback:function(r){e.$set(e.groupObj,t.subsystem_id+"",r)},expression:"groupObj[item.subsystem_id+'']"}},e._l(t.roleList,(function(t){return r("el-checkbox",{key:t.role_id,attrs:{label:t.role_id}},[e._v(e._s(t.role_name))])})),1):e._e()],1)}))],2)]),r("el-dialog",{staticClass:"user_edit",attrs:{title:"分配代理",visible:e.userDiaLog.chooseAgency,width:"50%"},on:{"update:visible":function(t){return e.$set(e.userDiaLog,"chooseAgency",t)},close:e.handleCloseChooseAgency},scopedSlots:e._u([{key:"footer",fn:function(){return[r("el-button",{on:{click:function(t){e.userDiaLog.chooseAgency=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSureAgencyChange}},[e._v("确 定")])]},proxy:!0}])},[r("div",{staticClass:"dia_body"},e._l(e.agList,(function(t){return r("el-radio",{key:t.id,attrs:{label:t.id},model:{value:e.agencyId,callback:function(t){e.agencyId=t},expression:"agencyId"}},[e._v(e._s(t.agency_name))])})),1),r("pagination",{staticClass:"pagination",attrs:{total:e.agTotal,pageSizes:[5,10,20],queryInfo:e.agencyInfo,queryFunc:e.getAgList}})],1)],1)},s=[],o=(r("4160"),r("45fc"),r("b0c0"),r("159b"),r("96cf"),r("1da1")),a=r("5530"),i=r("4ec3"),l=r("2fbc"),u=r("1799"),c=r("2f62"),m=r("6bfe"),d={name:"users",created:function(){this.userBtnList=this.powerList[this.$route.path]},mounted:function(){this.getUserList()},computed:Object(a["a"])({},Object(c["c"])("menu",["powerList"])),data:function(){return{userBtnList:[],listTotal:null,queryInfo:{name:"",status:null,pageParam:{page:1,pageSize:5}},userDiaLog:{userInfo:!1,editRole:!1,chooseAgency:!1},userForm:{name:"",password:"",user_type:null,mobile_phone:"",email:"",sex:null,login_account:"",check_code:""},formRules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:3,max:9,message:"长度在 3 到 9 个字符",trigger:"blur"}],login_account:[{required:!0,validator:m["a"],trigger:"blur"},{min:3,max:9,message:"长度在 3 到 9 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:18,message:"长度在 6 到 18 个字符",trigger:"blur"}],email:[{required:!0,validator:m["c"],trigger:"blur"}],mobile_phone:[{required:!0,validator:m["d"],trigger:"blur"}],check_code:[{required:!1,message:"请输入校验码",trigger:"blur"}]},userList:[],userId:null,groupObj:{},allRoleObj:{},roleList:[],checkAll:!1,isIndeterminate:!1,postNum:null,agencyInfo:{agency_code:null,agency_level:null,pageParam:{page:1,pageSize:10}},agencyId:null,agList:[],agTotal:null}},watch:{groupObj:{handler:function(e){var t=!0;for(var r in e)0!=e[r].length&&(t=!1);if(1==t)return this.isIndeterminate=!1,void(this.checkAll=!1);var n=!0;for(var s in this.allRoleObj){var o=this.allRoleObj[s].length,a=e[s].length;0!=o&&o!=a&&(n=!1)}1==n?(this.isIndeterminate=!1,this.checkAll=!0):(this.isIndeterminate=!0,this.checkAll=!1)},deep:!0}},methods:{$PowerKey:function(e){return this.userBtnList&&this.userBtnList.some((function(t){return t.name_en==e}))},getUserList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["A"])(e.queryInfo);case 2:r=t.sent,1e4!=r.code&&e.$message.error(r.message),e.userList=r.value,(!e.listTotal||e.listTotal!=r.num)&&(e.listTotal=r.num);case 6:case"end":return t.stop()}}),t)})))()},handleSwitchChange:function(e){var t=this;this.$confirm("确定要修改该用户的状态?","提示",{type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Object(i["a"])({id:e.id,status:1==e.status?0:1});case 2:if(n=r.sent,1e4===n.code){r.next=5;break}return r.abrupt("return",his.$message.error(n.message));case 5:t.$message.success(n.message),t.getUserList();case 7:case"end":return r.stop()}}),r)}))),(function(){console.log("点击了取消")}))},handleCloseDialog:function(e){Object.assign(this.userForm,this.$options.data().userForm),e&&e.resetFields()},handleAddUserClick:function(){this.userDiaLog.userInfo=!0,this.postNum=1,this.userForm.sex=2,this.userForm.user_type=2},handleEditUserClick:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.userInfoId=e,t.postNum=2,t.userDiaLog.userInfo=!0,r.next=5,Object(i["x"])({id:e});case 5:n=r.sent,1e4==n.code&&(t.userForm=Object(a["a"])({},n.value));case 7:case"end":return r.stop()}}),r)})))()},handleSureUser:function(e){var t=this;this.$refs.UserFormRef.validate((function(r){r&&(1==e?t.handleSureAddUser():2==e&&t.handleSureEditUser())}))},handleSureAddUser:function(){var e=this;this.$confirm("确定要添加该用户?","提示",{type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["w"])(e.userForm);case 2:r=t.sent,1e4==r.code&&(e.$message.success(r.message),e.userDiaLog.userInfo=!1,e.getUserList());case 4:case"end":return t.stop()}}),t)}))),(function(){console.log("点击了取消")}))},handleSureEditUser:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e.userInfoId),r=Object(a["a"])({id:e.userInfoId},e.userForm),t.next=4,Object(i["y"])(r);case 4:n=t.sent,1e4==n.code&&e.$message.success(n.message),e.userDiaLog.userInfo=!1,e.getUserList();case 8:case"end":return t.stop()}}),t)})))()},handleLoadUser:function(e){var t=this;Object(o["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.queryInfo.name=e.name,r.next=3,Object(i["A"])(t.queryInfo);case 3:n=r.sent,t.queryInfo.name="",1e4!=n.code?t.$message.error(n.message):t.$message.success(n.message),e=Object(a["a"])({},n.value);case 7:case"end":return r.stop()}}),r)})))()},handleRoleChange:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.userId=e.id,t.userForm.username=e.name,t.userDiaLog.editRole=!0,n={user_id:e.id},r.next=6,Object(i["f"])(n);case 6:if(s=r.sent,1e4==s.code){r.next=9;break}return r.abrupt("return",t.$message.error(s.message));case 9:t.roleList=s.value,console.log(t.roleList),o=!0,t.roleList.forEach((function(e){t.$set(t.groupObj,e.subsystem_id,[]),t.$set(t.allRoleObj,e.subsystem_id,[]),e.roleList.forEach((function(r,n){t.allRoleObj[e.subsystem_id].push(r.role_id),r.choose?(t.groupObj[e.subsystem_id].push(r.role_id),1!=t.isIndeterminate&&(t.isIndeterminate=!0)):o=!1}))})),1==o&&(t.isIndeterminate=!1,t.checkAll=o);case 14:case"end":return r.stop()}}),r)})))()},handleSureRoleChange:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(n in r=[],e.groupObj)console.log(n),0!=e.groupObj[n].length&&r.push({subsystem_id:n,role_id:e.groupObj[n]});return s={user_id:e.userId,deployRoleSubSystemList:r},t.next=5,Object(i["g"])(s);case 5:if(o=t.sent,console.log(o),1e4==o.code){t.next=9;break}return t.abrupt("return",e.$message.error(o.message));case 9:e.$message.success(o.message),e.userDiaLog.editRole=!1;case 11:case"end":return t.stop()}}),t)})))()},handleCheckAllChange:function(e){if(console.log(this.allRoleObj),e)for(var t in this.allRoleObj)this.groupObj[t]=this.allRoleObj[t];else for(var r in this.groupObj)this.$set(this.groupObj,r,[])},handleCloseEditRole:function(){console.log(this.groupObj),this.userId=null,this.checkAll=!1,this.roleList=[],this.groupObj={},this.isIndeterminate=!1},getAgList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["c"])(e.agencyInfo);case 2:if(r=t.sent,1e4==r.code){t.next=5;break}return t.abrupt("return",e.$message.error(r.message));case 5:e.agList=r.value,(!e.agTotal||e.agTotal!=r.num)&&(e.agTotal=r.num);case 7:case"end":return t.stop()}}),t)})))()},handleUpAgency:function(e){var t=this;if(console.log(e),1!=e.member)return this.$message.error("该用户无法升级为代理，只有会员才可以");this.$confirm("确定要升级该会员?","提示",{type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function r(){var n,s,o,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n={user_id:e.id},r.next=3,Object(i["b"])(n);case 3:if(s=r.sent,1e4==s.code){r.next=6;break}return r.abrupt("return",t.$message.error(s.message));case 6:return o={user_id:e.id,deployRoleSubSystemList:[{subsystem_id:23,role_id:[40]}]},r.next=9,Object(i["g"])(o);case 9:if(a=r.sent,1e4==a.code){r.next=12;break}return r.abrupt("return",t.$message.error(s.message));case 12:t.$message.success(s.message),t.getUserList();case 14:case"end":return r.stop()}}),r)}))),(function(){console.log("点击了取消")}))},handleAgencyChange:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.getAgList(),t.userId=e.id,t.userDiaLog.chooseAgency=!0;case 3:case"end":return r.stop()}}),r)})))()},handleSureAgencyChange:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log(e.agencyId),e.userId&&e.agencyId){t.next=3;break}return t.abrupt("return",e.$message.error("请选择~"));case 3:return r={agency_id:e.agencyId,user_id:e.userId},t.next=6,Object(i["B"])(r);case 6:if(n=t.sent,1e4==n.code){t.next=9;break}return t.abrupt("return",e.$message.error(n.message));case 9:e.$message.success(n.message),e.userDiaLog.chooseAgency=!1,e.getUserList();case 12:case"end":return t.stop()}}),t)})))()},handleCloseChooseAgency:function(){this.agencyId=null,this.userId=null}},components:{Breadcrumb:l["a"],Pagination:u["a"]}},g=d,p=(r("f451"),r("2877")),f=Object(p["a"])(g,n,s,!1,null,null,null);t["default"]=f.exports},f451:function(e,t,r){"use strict";var n=r("fe26"),s=r.n(n);s.a},fe26:function(e,t,r){}}]);
//# sourceMappingURL=chunk-29459e7f.638f1c73.js.map