(function(t){function e(e){for(var r,a,o=e[0],l=e[1],c=e[2],h=0,f=[];h<o.length;h++)a=o[h],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&f.push(n[a][0]),n[a]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);u&&u(e);while(f.length)f.shift()();return i.push.apply(i,c||[]),s()}function s(){for(var t,e=0;e<i.length;e++){for(var s=i[e],r=!0,o=1;o<s.length;o++){var l=s[o];0!==n[l]&&(r=!1)}r&&(i.splice(e--,1),t=a(a.s=s[0]))}return t}var r={},n={app:0},i=[];function a(e){if(r[e])return r[e].exports;var s=r[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=r,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(s,r,function(e){return t[e]}.bind(null,r));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/pnm_music/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;i.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var r=s("85ec"),n=s.n(r);n.a},"240d":function(t,e,s){t.exports=s.p+"img/cover1.06484ed6.jpg"},"56d7":function(t,e,s){"use strict";s.r(e);var r=s("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("home")],1)},i=[],a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[t._m(0),s("player")],1)},o=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mytips"},[s("img",{staticClass:"project_img",attrs:{src:"https://gitee.com/pengnima1/blogimage/raw/master/md/music_project.jpg",alt:"演示图"}}),t._v(" 右侧为演示图，操作方式：点击下方的黑色磁盘，选择 mp3 格式的乐曲，读取完毕后点击 播放按钮 ")])}],l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"player"}},[s("div",{staticClass:"player"},[s("div",{staticClass:"player_disk"},[s("disk")],1),s("div",{staticClass:"player_control"},[s("control")],1),s("div",{staticClass:"player_progress"},[s("progress-bar")],1)]),s("my-canvas")],1)},c=[],u=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"disk",class:{disk__playing:t.isPlaying}},[s("label",{ref:"cover",staticClass:"disk_cover",style:{transform:t.stopMatrix,backgroundImage:t.coverUrl?"url("+t.coverUrl+")":""},attrs:{for:"file"}}),s("input",{ref:"file",attrs:{id:"file",type:"file",accept:"music/mp3",multiple:""},on:{change:t.handleChange}})])},h=[],f=s("2f62");class p{constructor(){this.handlers=[]}push(t){this.handlers.push(t)}emit(){this.handlers.forEach(t=>{t()})}}class d{constructor(){this.audioCtx=new AudioContext,this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=128,this.utfArray=new Uint8Array(this.analyser.frequencyBinCount),this.tempArr=[],this.rectMargin=0,this.rectWidth=0,this.heightRate=0,this.playList=[],this.playIndex=0,this.emptyNode={file:null,start:null,offset:0,source:null,buffer:null},this.onPlay=new p,this.onPause=new p,this.onReady=new p,this.onChange=new p}amendData(t,e){this.rectMargin=Math.floor(t/this.analyser.frequencyBinCount)+1,this.rectWidth=this.rectMargin-1,this.heightRate=Math.floor(e/256*100)/100}drawCanvas(t,e,s){this.analyser.getByteFrequencyData(this.utfArray),s?(this.tempArr=this.utfArray,this.utfArray.forEach((s,r)=>{e.fillRect(10+r*this.rectMargin,t-s*this.heightRate,this.rectWidth,s*this.heightRate)})):this.tempArr.forEach((s,r)=>{s-- >0&&(e.fillRect(10+r*this.rectMargin,t-s*this.heightRate,this.rectWidth,s*this.heightRate),this.tempArr[r]=s)})}async getBuffer(t){return new Promise((e,s)=>{let r=new FileReader;r.onload=t=>{this.audioCtx.decodeAudioData(t.target.result).then(t=>{e(t)})},r.onerror=s,r.readAsArrayBuffer(t)})}async append(t){const e=this.isEmpty;this.playList.push({file:t,offset:0,start:null,source:null,buffer:await this.getBuffer(t)}),e&&this.onReady.emit()}play(){if(!this.playList.length||this.current.source)return;let t=this.audioCtx.createBufferSource();t.buffer=this.current.buffer,t.onended=()=>{this.next()},t.connect(this.analyser),this.analyser.connect(this.audioCtx.destination),t.start(0,this.current.offset),this.current.source=t,this.current.start=this.audioCtx.currentTime,this.onPlay.emit()}pause(){this.playList.length&&this.current.source&&(this.current.source.stop(0),this.current.source.disconnect(),this.current.source.onended=null,this.current.source=null,this.current.offset=this.position,this.current.start=null,this.onPause.emit())}stop(){this.pause(),this.current.offset=0}prev(){this.stop(),--this.playIndex,this.playIndex<0&&(this.playIndex=this.playList.length-1),this.play(),this.playList.length>1&&this.onChange.emit()}next(){this.stop(),++this.playIndex,this.playIndex>=this.playList.length&&(this.playIndex=0),this.play(),this.playList.length>1&&this.onChange.emit()}get isEmpty(){return this.current===this.emptyNode}get current(){return this.playList[this.playIndex]||this.emptyNode}get duration(){return this.current.buffer?this.current.buffer.duration:.001}get position(){return this.playList.length?this.current.offset+(null!=this.current.start?this.audioCtx.currentTime-this.current.start:0):0}set position(t){if(!this.playList.length)return;let e=t*this.duration;this.pause(),this.current.offset=e,this.play()}}const y=new d;var g={mounted(){y.onPlay.push(()=>{this.togglePlay(!0)}),y.onPause.push(()=>{this.togglePlay(!1)}),y.onChange.push(()=>{this.changeCover()}),y.onReady.push(()=>{this.changeCover()})},data(){return{stopMatrix:""}},methods:{...Object(f["b"])(["togglePlay","changeCover"]),async handleChange(){const t=this.$refs.file,e=t.files||[];if(e.length)for(let s=0;s<e.length;++s)await y.append(e[s]);t.value=""},musicLoad(t){console.log(t)}},computed:{...Object(f["c"])(["isPlaying","coverUrl"])},watch:{isPlaying(t){if(t){if(""!=this.stopMatrix){const t=this.stopMatrix;this.stopMatrix="";const e=t.match(/^matrix\(([^,]+),([^,]+)/);let s=Math.atan2(e[2],e[1])/Math.PI*180%360;const r=[...document.styleSheets];r.forEach(t=>{try{const e=[...t.cssRules];e.forEach(t=>{t.type===t.KEYFRAMES_RULE&&-1!=t.name.indexOf("rotateAnima")&&(t.cssRules[0].style.transform=`rotate(${s}deg)`,t.cssRules[1].style.transform=`rotate(${s+360}deg)`)})}catch(e){}})}}else this.stopMatrix=getComputedStyle(this.$refs.cover).transform}}},m=g,v=(s("cb4a"),s("2877")),b=Object(v["a"])(m,u,h,!1,null,"ddef64c0",null),_=b.exports,C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"control",class:{control__playing:t.isPlaying}},[s("div",{staticClass:"control_btn control_btn__side",on:{click:t.handlePrev}},[s("i",{staticClass:"fa fa-backward"})]),s("div",{staticClass:"control_btn",on:{click:t.handlePlay}},[s("span",{staticClass:"play-btn"})]),s("div",{staticClass:"control_btn control_btn__side",on:{click:t.handleNext}},[s("i",{staticClass:"fa fa-forward"})])])},x=[],P={computed:{...Object(f["c"])(["isPlaying"])},methods:{...Object(f["b"])(["togglePlay"]),handlePrev(){this.isPlaying&&y.prev()},handlePlay(){y.isEmpty||(this.isPlaying?y.pause():y.play())},handleNext(){this.isPlaying&&y.next()}}},w=P,j=(s("5bf3"),Object(v["a"])(w,C,x,!1,null,"6737beab",null)),O=j.exports,M=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"progress",class:{progress__playing:t.isPlaying}},[s("h2",{staticClass:"progress_title"},[t._v(t._s(t._f("formatName")(t.name)))]),s("p",{staticClass:"progress_text"},[t._v(t._s(t._f("formatTime")(t.position))+"/ "+t._s(t._f("formatTime")(t.duration)))]),s("div",{ref:"line",staticClass:"progress_line",on:{click:t.setPos}},[s("span",{style:{width:t.progress}})])])},E=[],$={methods:{setPos(t){let e=parseFloat(getComputedStyle(this.$refs.line).width),s=t.offsetX/e;y.position=s}},mounted(){const t=()=>{window.requestAnimationFrame(t);const e=y.position/y.duration;this.progress=`${(100*e).toFixed(2)}%`,this.position=y.position,this.duration=y.duration,this.name=y.current.file?y.current.file.name:""};t()},data(){return{name:"",position:0,duration:.001,progress:""}},computed:{...Object(f["c"])(["isPlaying"])},filters:{formatName(t){return t.replace(/\.mp3$/,"")},formatTime(t){const e=Math.floor(t/60),s=Math.floor(t%60);return`${e}:${s<10?"0":""}${s}`}}},A=$,R=(s("aa09"),Object(v["a"])(A,M,E,!1,null,null,null)),S=R.exports,k=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},L=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"my_canvas"}},[s("canvas",{staticClass:"canvas"})])}],I={mounted(){let t=document.querySelector(".canvas"),e=t.getContext("2d"),s=t.width,r=t.height,n=e.createLinearGradient(0,0,0,r);n.addColorStop(1,"green"),n.addColorStop(.5,"yellow"),n.addColorStop(0,"red"),e.fillStyle=n,y.amendData(s,r);const i=()=>{e.clearRect(0,0,s,r),y.drawCanvas(r,e,this.isPlaying),window.requestAnimationFrame(i)};i()},data(){return{}},computed:{...Object(f["c"])(["isPlaying"])}},B=I,T=(s("6c68"),Object(v["a"])(B,k,L,!1,null,null,null)),F=T.exports,N={components:{Disk:_,Control:O,ProgressBar:S,MyCanvas:F}},U=N,q=(s("bc12"),Object(v["a"])(U,l,c,!1,null,"270f6769",null)),D=q.exports,W={components:{Player:D}},J=W,z=(s("f6f5"),Object(v["a"])(J,a,o,!1,null,"1e807b22",null)),G=z.exports,H={name:"App",components:{Home:G}},K=H,X=(s("034f"),Object(v["a"])(K,n,i,!1,null,null,null)),Y=X.exports;r["a"].use(f["a"]);let Q=0;const V=[s("240d"),s("8849"),s("bdff")],Z=new f["a"].Store({state:{isPlaying:!1,coverUrl:""},mutations:{togglePlay(t,e){t.isPlaying=e},changeCover(t){t.coverUrl=V[Q++],Q>=3&&(Q=0)}},actions:{},getters:{}});var tt=Z;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(Y)},store:tt}).$mount("#app")},"5a4a":function(t,e,s){},"5bb2":function(t,e,s){},"5bf3":function(t,e,s){"use strict";var r=s("5bb2"),n=s.n(r);n.a},"6c68":function(t,e,s){"use strict";var r=s("f8c4"),n=s.n(r);n.a},"6c9e":function(t,e,s){},"85ec":function(t,e,s){},8849:function(t,e,s){t.exports=s.p+"img/cover2.3c186b85.jpg"},aa09:function(t,e,s){"use strict";var r=s("b2b6"),n=s.n(r);n.a},b2b6:function(t,e,s){},bc12:function(t,e,s){"use strict";var r=s("5a4a"),n=s.n(r);n.a},bdff:function(t,e,s){t.exports=s.p+"img/cover3.acb6337c.jpg"},cb4a:function(t,e,s){"use strict";var r=s("6c9e"),n=s.n(r);n.a},f6f5:function(t,e,s){"use strict";var r=s("fdda"),n=s.n(r);n.a},f8c4:function(t,e,s){},fdda:function(t,e,s){}});
//# sourceMappingURL=app.6e33fc23.js.map